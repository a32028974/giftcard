<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Imprimir lote de giftcards (QR)</title>
<style>
  :root{
    --bg-url: url('img/voucher-bg.jpg'); /* <- tu imagen */
    --card-w: 150mm;   /* 15 cm */
    --card-h: 100mm;   /* 10 cm */
  }
  *{box-sizing:border-box}
  body{margin:0; font-family:system-ui,Segoe UI,Roboto,Arial}
  header{display:flex; align-items:center; justify-content:space-between; gap:12px; padding:14px 16px; border-bottom:1px solid #e5e7eb; position:sticky; top:0; background:#fff}
  .btn{padding:10px 14px; border:1px solid #d1d5db; border-radius:10px; background:#111827; color:#fff; font-weight:600; cursor:pointer}
  .btn.secondary{background:#fff; color:#111827}
  .wrap{padding:16px}
  .grid{display:grid; grid-template-columns:1fr; gap:18px}
  .card{
    width:var(--card-w); height:var(--card-h);
    background: #fff var(--bg-url) center/cover no-repeat;
    border:1px solid #d1d5db; border-radius:12px;
    position:relative; overflow:hidden; margin:auto; page-break-inside:avoid;
  }
  /* Caja del QR (puedes moverla donde quieras) */
  .qr-box{
    position:absolute; right:12mm; bottom:14mm;
    width:36mm; height:36mm; background:#fff; border:1px solid #d1d5db; border-radius:6px;
    display:flex; align-items:center; justify-content:center;
  }
  .code{
    position:absolute; bottom:6mm; right:12mm;
    font-family:ui-monospace,Consolas,monospace; font-size:12pt; letter-spacing:.4px; background:rgba(255,255,255,.85);
    padding:4px 8px; border-radius:6px; border:1px solid rgba(0,0,0,.06);
  }
  .hint{color:#6b7280; font-size:13px}
  @media print {
    header,.hint{display:none}
    body{background:#fff}
    .wrap{padding:0}
    .grid{gap:0}
    .card{margin:0 auto 10mm}
  }
</style>
</head>
<body>
  <header>
    <div>
      <strong>Lote de 5 giftcards</strong><br>
      <span class="hint">Tamaño por tarjeta: 15×10 cm • Cada QR apunta al viewer</span>
    </div>
    <div>
      <button id="regen" class="btn secondary">Regenerar códigos</button>
      <button id="print" class="btn">Imprimir</button>
    </div>
  </header>

  <div class="wrap">
    <div id="list" class="grid"></div>
  </div>

  <!-- QRCode (CDN) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>
    // ======= CONFIGURAR ESTO: URL de tu App Script (viewer) =======
    const VIEW_URL = 'PASTE_YOUR_WEB_APP_URL_HERE'; // ej.: https://script.google.com/macros/s/XXXX/exec

    // ======= Helpers =======
    function robustURL(base){
      const b=(base||'').trim(); if(!b) throw new Error('VIEW_URL vacío');
      try{ return new URL(b); } catch { return new URL(b, window.location.href); }
    }
    function urlForCode(code){
      const u = robustURL(VIEW_URL); u.searchParams.set('code', code); u.searchParams.set('action','view'); return u.toString();
    }
    function randCode(){
      const CH='abcdefhijkmnpqrstuvwxyz23456789'; // sin 0/1/o/l
      let s=''; for(let i=0;i<8;i++) s+=CH[Math.floor(Math.random()*CH.length)];
      return s.slice(0,4)+'-'+s.slice(4,8);
    }
    function makeCard(code){
      const div = document.createElement('div'); div.className='card';
      // QR box
      const qb = document.createElement('div'); qb.className='qr-box'; div.appendChild(qb);
      // code text
      const ct = document.createElement('div'); ct.className='code'; ct.textContent=code; div.appendChild(ct);
      // build QR for viewer link
      new QRCode(qb,{text:urlForCode(code),width:300,height:300,correctLevel:QRCode.CorrectLevel.M});
      return div;
    }
    function renderList(codes){
      const list=document.getElementById('list'); list.innerHTML='';
      // 5 tarjetas
      for(const c of codes){ list.appendChild(makeCard(c)); }
    }
    function genFive(){ return Array.from({length:5},()=>randCode()); }

    // init
    let current = genFive();
    renderList(current);

    document.getElementById('regen').onclick = ()=>{ current=genFive(); renderList(current); };
    document.getElementById('print').onclick = ()=>{ window.print(); };
  </script>
</body>
</html>
